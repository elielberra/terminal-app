#include <tunables/global>

profile terminal-app {
    # app source (read-only, except locks on go.mod/go.sum)
    /app/            r,
    /app/**          r,
    /app/go.mod      rk,
    /app/go.sum      rk,

    # temp + build cache
    /tmp/            rwk,
    /tmp/**          rwkix,

    # Go module cache
    /go/pkg/mod/     r,
    /go/pkg/mod/**   rix,

    # Go download cache
    /go/pkg/mod/cache/     rwk,
    /go/pkg/mod/cache/**   rwkix,

    # Standard library & toolchain
    /usr/local/go/   r,
    /usr/local/go/** rix,

    # User cache
    /home/web-user/.cache/      rwk,
    /home/web-user/.cache/**    rwkix,

    # Devices
    /dev/null        rw,
    /dev/urandom     r,
    /dev/ptmx     rw,
    /dev/pts/**   rw,

    # System compiler (for cgo)
    /usr/bin/gcc-12   rix,
    /usr/bin/*gcc*   rix,

    # Add a comment here
    /etc/ld.so.cache  r,
    /lib/**           mr,
    /usr/lib/**       mr,
    /usr/lib/gcc/**   rix,

    # Add a comment here
    /usr/include/      r,
    /usr/include/**    r,
    /usr/bin/as    rix,
    /usr/bin/x86_64-linux-gnu-as   rix,
    /usr/bin/*ld*   rix,

    network inet stream,

    # Allow container to receive SIGTERM/SIGKILL from Docker
    signal (receive) peer=unconfined,
}
