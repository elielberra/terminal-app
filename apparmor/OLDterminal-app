#include <tunables/global>

profile terminal-app flags=(attach_disconnected,mediate_deleted,enforce) {
  network,
  capability,
  file,

  # ---- Default deny everything
  # deny /** mrwklx,

  # Shared libs must be memory-mappable
  /lib/**                       mr,
  /lib64/**                     mr,
  /usr/lib/**                   mr,
  
  # Keep ld cache
  /etc/ld.so.cache             r,
  # (optional)
  /etc/ld.so.preload           r,

  # ---- Devices commonly needed
  /dev/null               rw,
  /dev/urandom            r,

  # ---- Your app: read configs/assets + execute the binary
  /app/**                 r,
  /app/**                 ix,

  # ---- Allow a scratchpad
  /tmp/                   rwk,
  /tmp/**                 rwkix,

  /dev/ptmx               rw,
  /dev/pts/**             rw,

  # TODO: Check if necessary

  # ---- Only allow normal TCP sockets; disallow raw/packet network
  network inet stream,
  network inet6 stream,
  deny network raw,
  deny network packet,

  # ---- Permit running ONLY a few commands
  /bin/cat                ix,
  /bin/rbash              ix,
  /bin/echo               ix,

  # ---- No Linux caps
  deny capability,
}
